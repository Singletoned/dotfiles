{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/bash

sudo -v

if [[ ! -d /usr/libexec/rosetta ]]; then
   sudo softwareupdate --install-rosetta
fi

# .Brewfile hash: {{ include ".Brewfile" | sha256sum }}

if [[ $(command -v brew) == "" ]]; then
    echo "Installing Hombrew"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    eval "$(/opt/homebrew/bin/brew shellenv)"
else
    echo "Updating Homebrew"
    brew update
fi

brew bundle --no-lock --file={{ joinPath .chezmoi.sourceDir ".Brewfile" | quote }}

{{ end -}}
